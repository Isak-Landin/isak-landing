{# templates/admin_dashboard.html #}
{% extends "layouts/admin_dashboard_content_base.html" %}

{% block page_title %}Admin Dashboard{% endblock %}

{% block hero_back_href %}{{ url_for('admin_blueprint.dashboard') }}{% endblock %}
{% block hero_back_label %}&larr; Admin Panel Home{% endblock %}
{% block hero_title %}Admin Overview{% endblock %}
{% block hero_actions %}{% endblock %}
{% block hero_meta %}
  <span class="avatar-emoji" aria-hidden="true">ğŸ›¡ï¸</span>
  <span class="email">Logged in as Admin</span>
  <span class="sep">Â·</span>
  <span class="text-mute">Manage users, subscriptions, and VPS instances.</span>
{% endblock %}

{% block page_content %}

  <div class="dashboard-summary">
    <div class="card">ğŸ‘¥ <strong id="user-count">â€“</strong> Users</div>
    <div class="card">ğŸ§¾ <strong id="sub-count">â€“</strong> Subscriptions</div>
    <div class="card">ğŸ–¥ï¸ <strong id="vps-count">â€“</strong> VPSes</div>
  </div>

  <section class="admin-section">
    <div class="admin-tab-bar">
      <div class="tab-pill active" id="tab-users">ğŸ‘¥ Users</div>
      <div class="tab-pill" id="tab-subs">ğŸ§¾ Subscriptions</div>
      <div class="tab-pill" id="tab-vps">ğŸ–¥ï¸ VPS</div>
      {# NEW: billing subs tab #}
      <div class="tab-pill" id="tab-billsubs">ğŸ’³ Billing (Subs)</div>

      <button id="admin-refresh" class="admin-refresh" type="button" aria-label="Refresh">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21 12a9 9 0 1 0-3.32 6.94" />
          <path d="M21 12v6h-6" />
        </svg>
        <span class="label">Refresh</span>
      </button>
    </div>

    <div class="table-container" id="users-table">
      <table>
        <thead>
          <tr><th>Email</th><th>VPS Count</th></tr>
        </thead>
        <tbody id="users-body">{# filled by JS #}</tbody>
      </table>
    </div>

    <div class="table-container hidden" id="subs-table">
      <table>
        <thead>
          <tr>
            <th>Owner</th><th>Plan</th><th>Interval</th>
            <th>Status</th><th>Price</th>
            <th>VPS</th>            <!-- NEW -->
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="subs-body"></tbody>
      </table>
    </div>


    <div class="table-container hidden" id="vps-table">
      <table>
        <thead>
          <tr>
            <th>Hostname</th><th>IP</th><th>OS</th>
            <th>CPU</th><th>RAM</th><th>Owner</th>
          </tr>
        </thead>
        <tbody id="vps-body">{# filled by JS #}</tbody>
      </table>
    </div>

    {# NEW: billing subscriptions table #}
    <div class="table-container hidden" id="billing-subs-table">
      <table>
        <thead>
          <tr>
            <th>Created</th>
            <th>User</th>
            <th>Subscription</th>
            <th>Description</th>
            <th style="text-align:right;">Amount</th>
            <th>Status</th>
            <th>Mode</th>
          </tr>
        </thead>
        <tbody id="billing-subs-body">{# filled by JS #}</tbody>
      </table>
    </div>
  </section>

{% endblock %}

{% block extra_js %}{{ super() }}
<script src="{{ url_for('static', filename='js/admin/users_table.js') }}?v=4"></script>
<script src="{{ url_for('static', filename='js/admin/subscription_table.js') }}?v=9"></script>
<script src="{{ url_for('static', filename='js/admin/vps_table.js') }}?v=7"></script>

<script>
  console.log('[admin/vps]', 'after include: window.__vpsLoadedStamp =', window.__vpsLoadedStamp);
</script>

{# NEW: renderer for the Billing (Subs) tab #}
<script src="{{ url_for('static', filename='js/admin/billing_subs_table.js') }}?v=4"></script>

{# tabs controller last #}
<script src="{{ url_for('static', filename='js/admin/tabs_controller.js') }}?v=4"></script>
{% endblock %}

