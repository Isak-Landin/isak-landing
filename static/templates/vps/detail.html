{# templates/vps/detail.html #}
{% extends "layouts/dashboard_content_base.html" %}

{% block page_title %}VPS â€” {{ vps.hostname }}{% endblock %}

{% block hero_title %}{{ vps.hostname }}{% endblock %}
{% block hero_actions %}{% endblock %}
{% block hero_meta %}
  <div class="trust-strip">
    <span class="trust-pill">ğŸ†” #{{ vps.id }}</span>
    {% if vps.ip_address %}
      <span class="trust-pill">ğŸ“¡ {{ vps.ip_address }}</span>
    {% endif %}
    <span class="trust-pill">âš™ï¸ {{ vps.os or 'OS: â€”' }}</span>
    <span class="trust-pill">ğŸ”Œ Status: {{ (vps.status or 'â€”')|capitalize }}</span>
    {% if vps.is_ready %}
      <span class="trust-pill">âœ… Ready</span>
    {% else %}
      <span class="trust-pill">â³ {{ vps.provisioning_status or 'pending' }}</span>
    {% endif %}
  </div>
{% endblock %}

{% block page_content %}
<div class="dashboard-page">

  <h2 class="section-title">Overview</h2>
  <section class="card-panel" aria-labelledby="vps-overview">
    <header class="card-head">
      <h3 id="vps-overview" class="title">Snapshot</h3>
    </header>

    <ul class="card-list" role="list">
      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸ–¥ï¸</span>
        <span class="text">
          <span class="title"><strong>Hostname</strong></span>
          <span class="sub">{{ vps.hostname }}</span>
        </span>
      </li>

      {% if vps.ip_address %}
      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸ“¡</span>
        <span class="text">
          <span class="title"><strong>IP Address</strong></span>
          <span class="sub">{{ vps.ip_address }}</span>
        </span>
      </li>
      {% endif %}

      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸ’¿</span>
        <span class="text">
          <span class="title"><strong>System</strong></span>
          <span class="sub">
            {{ vps.os or 'â€”' }}
            {% if vps.cpu_cores %} Â· CPU: {{ vps.cpu_cores }} cores{% endif %}
            {% if vps.ram_mb %} Â· RAM: {{ vps.ram_mb }} MB{% endif %}
            {% if vps.disk_gb %} Â· Disk: {{ vps.disk_gb }} GB{% endif %}
          </span>
        </span>
      </li>

      {% if vps.location or vps.region %}
      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸŒ</span>
        <span class="text">
          <span class="title"><strong>Location</strong></span>
          <span class="sub">
            {{ vps.location or 'â€”' }}
            {% if vps.region %} Â· Region: {{ vps.region }}{% endif %}
          </span>
        </span>
      </li>
      {% endif %}

      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸ“ˆ</span>
        <span class="text">
          <span class="title"><strong>Status</strong></span>
          <span class="sub">
            {{ (vps.status or 'â€”')|capitalize }}
            {% if vps.provisioning_status %} Â· {{ vps.provisioning_status }}{% endif %}
            {% if vps.is_ready %} Â· ready{% endif %}
          </span>
        </span>
      </li>
    </ul>
  </section>

  <h2 class="section-title" style="margin-top:18px;">Access credentials</h2>
  <section class="card-panel" aria-labelledby="vps-credentials">
    <header class="card-head">
      <h3 id="vps-credentials" class="title">Default login</h3>
      <div class="meta">Change these after first login.</div>
    </header>

    <ul class="card-list" role="list">
      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸ‘¤</span>
        <span class="text">
          <span class="title"><strong>Username</strong></span>
          <span class="sub" id="cred-username">
            {{ vps.default_username or 'Not set yet' }}
          </span>
        </span>
        {% if vps.default_username %}
          <span class="spacer"></span>
          <button class="button ghost" type="button"
                  data-copy="#cred-username" aria-label="Copy username">
            Copy
          </button>
        {% endif %}
      </li>

      <li class="card-item">
        <span class="emoji" aria-hidden="true">ğŸ”’</span>
        <span class="text">
          <span class="title"><strong>Password</strong></span>
          <span class="sub">
            {% if vps.default_password %}
              <span id="cred-password" data-secret="{{ vps.default_password }}" data-masked="true">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
            {% else %}
              Not set yet
            {% endif %}
          </span>
        </span>

        {% if vps.default_password %}
          <span class="spacer"></span>
          <div class="btn-group" style="display:flex; gap:8px;">
            <button class="button ghost" type="button" id="reveal-pass" aria-pressed="false" aria-controls="cred-password">
              Reveal
            </button>
            <button class="button ghost" type="button" data-copy="#cred-password" aria-label="Copy password">
              Copy
            </button>
          </div>
        {% endif %}
      </li>
    </ul>

    <p class="sub" style="margin:10px 2px 0; opacity:.9;">
      Tip: use SSH or your providerâ€™s console. Be sure to update the password and
      keep it safe. We only show the initial password here.
    </p>
  </section>

</div>
{% endblock %}

{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=10">
{% endblock %}

{% block extra_js %}{{ super() }}
<script>
  // Simple copy + reveal logic, no external JS required.
  function copyFrom(selector) {
    const el = document.querySelector(selector);
    if (!el) return;
    const text = el.dataset && el.dataset.secret ? el.dataset.secret : el.textContent;
    navigator.clipboard.writeText(text.trim()).catch(()=>{});
  }

  document.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-copy]');
    if (btn) {
      e.preventDefault();
      copyFrom(btn.getAttribute('data-copy'));
    }
  });

  const revealBtn = document.getElementById('reveal-pass');
  const passEl = document.getElementById('cred-password');
  if (revealBtn && passEl) {
    revealBtn.addEventListener('click', () => {
      const masked = passEl.getAttribute('data-masked') === 'true';
      if (masked) {
        passEl.textContent = passEl.getAttribute('data-secret') || '';
        passEl.setAttribute('data-masked', 'false');
        revealBtn.textContent = 'Hide';
        revealBtn.setAttribute('aria-pressed', 'true');
      } else {
        passEl.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
        passEl.setAttribute('data-masked', 'true');
        revealBtn.textContent = 'Reveal';
        revealBtn.setAttribute('aria-pressed', 'false');
      }
    });
  }
</script>
{% endblock %}
