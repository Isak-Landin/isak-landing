{# static/templates/vps/list.html #}
{% extends "layouts/base.html" %}
{% block title %}VPS Plans{% endblock %}

{% block content %}
<section class="radial-dark-section hero-condensed">
  <div class="container">
    <h1>Choose your VPS</h1>
    <p class="intro-lead">Simple pricing. Scale later.</p>
  </div>
</section>

<section class="split-section">
  <div class="container">
    <div class="plans-grid">
      {% for p in plans %}
      <article class="plan-card">
        <header class="plan-head">
          <h3>{{ p.name }}</h3>
          {% if p.description %}<p class="muted">{{ p.description }}</p>{% endif %}
        </header>

        <ul class="specs">
          <li><strong>{{ p.vcpu }}</strong> vCPU</li>
          <li><strong>{{ p.ram_gb }}</strong> GB RAM</li>
          <li><strong>{{ p.ssd_gb }}</strong> GB NVMe</li>
          <li><strong>{{ p.bandwidth_tb }}</strong> TB bandwidth</li>
        </ul>

        {% if current_user.is_authenticated %}
          <div class="actions">
            <button class="button primary"
                    onclick="startCheckout('{{ p.plan_code }}','month')">
              Buy monthly
            </button>
            <button class="button"
                    onclick="startCheckout('{{ p.plan_code }}','year')">
              Buy yearly
            </button>
          </div>
        {% else %}
          <a class="button"
             href="{{ url_for('auth_blueprint.login') }}?next={{ url_for('vps_blueprint.vps_list_page') }}">
            Log in to buy
          </a>
        {% endif %}
      </article>
      {% endfor %}
    </div>
  </div>
</section>

{% if current_user.is_authenticated %}
<script>
async function startCheckout(planCode, interval) {
  try {
    const res = await fetch('{{ url_for("vps_blueprint.vps_checkout") }}', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ plan_code: planCode, interval })
    });
    const data = await res.json();
    if (!data.ok) throw new Error(data.error || 'Checkout failed');
    window.location = data.checkout_url;
  } catch (e) {
    alert(e.message || 'Something went wrong starting checkout.');
  }
}
</script>
{% endif %}
{% endblock %}
