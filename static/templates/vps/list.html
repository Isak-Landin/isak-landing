{% extends "layouts/dashboard_content_base.html" %}
{% block title %}VPS Plans{% endblock %}

{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_vps.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/vps/cart.css') }}?v=2">
{% endblock %}

{# ---- Content-base hero slots ---- #}
{% block page_title %}VPS Plans{% endblock %}
{% block hero_title %}Your Virtual Private Servers{% endblock %}

{# Remove the button entirely #}
{% block hero_actions %}{% endblock %}

{% block hero_meta %}
  <div class="hero-text">Fast, secure, and always in your control.</div>

  <div class="trust-strip" aria-label="Trust and assurances">
    <span class="trust-pill">üîí Secure checkout</span>
    <span class="trust-pill">‚úÖ No hidden fees</span>
    <span class="trust-pill">‚Ü©Ô∏è Cancel anytime</span>
  </div>

  <div class="brand-strip" aria-label="Supported payment methods">
    <img src="{{ url_for('static', filename='images/payments/visa.png') }}" alt="Visa">
    <img src="{{ url_for('static', filename='images/payments/mastercard.png') }}" alt="Mastercard">
  </div>
{% endblock %}

{# ---- Main content ---- #}
{% block page_content %}

  <section class="radial-dark-section hero-condensed">
    <div class="container">
      <h1 class="hero-condensed-title">Choose your VPS</h1>
      <p class="intro-lead hero-condensed-text">Simple pricing. Scale later.</p>
    </div>
  </section>

  <section class="split-section">
    <div class="container">
      <div class="plans-grid">
        {% for p in plans %}
        <article class="plan-card">
          <header class="plan-head">
            <h3 class="plan-title">{{ p.name }}</h3>
          </header>

          <ul class="specs">
            <li><strong>{{ p.vcpu }}</strong> vCPU</li>
            <li><strong>{{ p.ram_gb }}</strong> GB RAM</li>
            <li><strong>{{ p.ssd_gb }}</strong> GB NVMe</li>
            <li><strong>{{ p.bandwidth_tb }}</strong> TB bandwidth</li>
            <li><strong>OS</strong> of choice</li>
          </ul>

          {% if current_user.is_authenticated %}
            <div class="plan-actions">
              <button class="plan-btn plan-btn--ghost"
                      data-plan="{{ p.plan_code }}"
                      data-interval="month"
                      data-name="{{ p.name }}"
                      data-vcpu="{{ p.vcpu }}"
                      data-ram="{{ p.ram_gb }}"
                      data-ssd="{{ p.ssd_gb }}"
                      data-bandwidth="{{ p.bandwidth_tb }}"
                      data-price-month="{{ p.price_month }}"
                      data-price-year="{{ p.price_year }}"
                      data-currency="{{ p.currency }}">
                Get
              </button>


            </div>
          {% else %}
            <a class="plan-btn plan-btn--ghost"
               href="{{ url_for('auth_blueprint.login') }}?next={{ url_for('vps_blueprint.vps_list_page') }}">
              Log in to get
            </a>
          {% endif %}
        </article>
        {% endfor %}
      </div>
    </div>
  </section>

<!-- Mini Cart Drawer -->
<div id="vps-mini-cart-backdrop" class="vps-cart-backdrop" hidden></div>

<aside id="vps-mini-cart" class="vps-cart-drawer" aria-hidden="true">
  <header class="vps-cart-head">
    <h3 class="vps-cart-title">Review & continue</h3>
    <button type="button" class="vps-cart-close" aria-label="Close">√ó</button>
  </header>

  <div class="vps-cart-body">
    <div class="vps-cart-summary">
      <div class="vps-cart-plan">
        <div class="vps-cart-plan-name" id="vps-cart-name">‚Äî</div>
        <ul class="vps-cart-specs">
          <li><strong id="vps-cart-vcpu">‚Äî</strong> vCPU</li>
          <li><strong id="vps-cart-ram">‚Äî</strong> GB RAM</li>
          <li><strong id="vps-cart-ssd">‚Äî</strong> GB NVMe</li>
          <li><strong id="vps-cart-bw">‚Äî</strong> TB bandwidth</li>
        </ul>
      </div>

      <div class="vps-cart-price">
        <span id="vps-cart-price-amount">‚Äî</span>
        <span id="vps-cart-price-currency"></span>
        <span id="vps-cart-price-interval" class="muted">/ month</span>
      </div>

      <form id="vps-mini-cart-form">
        <input type="hidden" name="plan_code" id="vps-cart-plan-code" value="">

        <div class="vps-cart-row">
          <label class="vps-cart-label">Billing interval</label>
          <div class="vps-cart-interval">
            <label>
              <input type="radio" name="interval" value="month" checked> Monthly
            </label>
            <label>
              <input type="radio" name="interval" value="year"> Yearly
            </label>
          </div>
        </div>

        <div class="vps-cart-row">
          <label class="vps-cart-legal">
            <input type="checkbox" id="vps-cart-accept-legal" required>
            <span>
              I agree to the
              <a href="{{ url_for('legal_blueprint.legal_detail', slug='terms') }}" target="_blank" rel="noopener">Terms</a>,
              <a href="{{ url_for('legal_blueprint.legal_detail', slug='privacy') }}" target="_blank" rel="noopener">Privacy</a>,
              and
              <a href="{{ url_for('legal_blueprint.legal_detail', slug='aup') }}" target="_blank" rel="noopener">AUP</a>.
            </span>
          </label>
        </div>

        <div id="vps-cart-error" class="auth-error" style="display:none;"></div>

        <div class="vps-cart-actions">
          <button id="vps-cart-submit" type="submit" class="button primary">Proceed to payment</button>
          <button type="button" class="button ghost vps-cart-close">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</aside>


{% endblock %}

{% block extra_js %}{{ super() }}
{% if current_user.is_authenticated %}
  <script>
    // Default interval = month
    window.VPS_CHECKOUT_URL = "{{ url_for('vps_blueprint.vps_checkout') }}";
  </script>
  <script src="{{ url_for('static', filename='js/vps/cart.js') }}"></script>
  <script src="{{ url_for('static', filename='js/vps/list.js') }}"></script>
{% endif %}
{% endblock %}
