{# templates/order_history.html #}
{% extends "layouts/dashboard_content_base.html" %}
{% block page_title %}Order History{% endblock %}

{# HERO stays as you already have it #}
{% block hero_title %}Order History{% endblock %}
{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/user/orders.css') }}">
{% endblock %}
{% block hero_text %}Review invoices, charges, and subscription status.{% endblock %}
{% block hero_meta %}
  <span class="trust-pill">ðŸ§¾ All invoices & subscriptions</span>
  <span class="trust-pill">ðŸ§ª Mode: {{ 'Live' if mode=='live' else 'Test' if mode=='test' else 'All' }}</span>
  <span class="trust-pill">ðŸ“Š {{ records|length if records else 0 }} records</span>
{% endblock %}
{% block hero_actions %}{% endblock %}

{% block page_content %}

  <div class="orders-filter">
    <a href="{{ url_for('vps_blueprint.orders_page', mode='all') }}"  class="{{ 'active' if mode=='all'  else '' }}">All</a>
    <a href="{{ url_for('vps_blueprint.orders_page', mode='live') }}" class="{{ 'active' if mode=='live' else '' }}">Live</a>
    <a href="{{ url_for('vps_blueprint.orders_page', mode='test') }}" class="{{ 'active' if mode=='test' else '' }}">Test</a>
  </div>

  {% if records and records|length %}
    <div class="table-wrap">
      <table class="orders-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Mode</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for r in records %}
            <tr>
              <td>{{ (r.created_at or r.period_end or r.period_start).strftime('%Y-%m-%d %H:%M') if (r.created_at or r.period_end or r.period_start) else '-' }}</td>
              <td>{{ r.type|replace('_',' ')|title }}</td>
              <td>{{ r.description or '-' }}</td>
              <td class="amount">
                {% if r.amount_cents is not none and r.currency %}
                  {{ '%.2f'|format(r.amount_cents / 100.0) }} {{ r.currency.upper() }}
                {% else %}-{% endif %}
              </td>
              <td>{{ r.status or '-' }}</td>
              <td>
                <span class="mode-pill {{ 'live' if r.livemode else 'test' }}">
                  {{ 'Live' if r.livemode else 'Test' }}
                </span>
              </td>
              <td class="orders-actions">
                {% if r.hosted_invoice_url %}<a href="{{ r.hosted_invoice_url }}" target="_blank" rel="noopener">Invoice</a>{% endif %}
                {% if r.invoice_pdf %}{% if r.hosted_invoice_url %}<a href="{{ r.invoice_pdf }}" target="_blank" rel="noopener">PDF</a>{% else %}<a href="{{ r.invoice_pdf }}" target="_blank" rel="noopener">PDF</a>{% endif %}{% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="empty-state">
      <div class="emoji">ðŸ“¦</div>
      <p class="empty-text">You havenâ€™t made any purchases yet.</p>
      <a href="{{ url_for('vps_blueprint.vps_list_page') }}" class="button primary">Browse VPS Plans</a>
    </div>
  {% endif %}

{% endblock %}

{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/orders.css') }}">
{% endblock %}
