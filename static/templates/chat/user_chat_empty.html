{% extends "layouts/base.html" %}

{% block title %}Start a Chat{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/subpages.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-layout">
  <aside class="dashboard-sidenav">
    <h2 class="nav-title">Dashboard</h2>
    <ul class="nav-links">
      <li><a href="{{ url_for('users_blueprint.dashboard') }}">ğŸ–¥ï¸ My Servers</a></li>
      <li><a href="{{ url_for('store_blueprint.store') }}">ğŸ›’ Store</a></li>
      <li><a href="{{ url_for('store_blueprint.order_history') }}">ğŸ“¦ Purchases</a></li>
      <li><a href="{{ url_for('chat_blueprint.view_user_chat') }}" class="active">ğŸ’¬ Chat</a></li>
      <li><a href="{{ url_for('auth_blueprint.logout') }}">ğŸ”“ Log Out</a></li>
    </ul>
  </aside>

  <main class="dashboard-main">
    <section class="radial-dark-section hero-condensed">
      <div class="container">
        <h1>Support Chat</h1>
        <p class="intro-lead">Need help with something? Start a chat with support.</p>
        <form id="start-chat-form" action="{{ url_for('chat_blueprint.start_chat') }}" method="post">
          <button type="submit" class="button primary">Start Chat</button>
        </form>
      </div>
    </section>
  </main>
</div>

{% block extra_js %}
<script>
  document.getElementById('start-chat-form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const response = await fetch(this.action, { method: 'POST' });
    const result = await response.json();
    if (result.chat_id) {
      window.location.href = `/chat/view`;  // Will now load the open chat
    } else {
      alert("Something went wrong starting your chat.");
    }
  });
</script>
{% endblock %}
{% endblock %}

