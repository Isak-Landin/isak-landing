{# templates/chat/admin_chat_inbox.html #}
{% extends "layouts/admin_dashboard_content_base.html" %}

{% block page_title %}Chat Inbox{% endblock %}

{# HERO #}
{% block hero_back_href %}{{ url_for('admin_blueprint.dashboard') }}{% endblock %}
{% block hero_back_label %}&larr; Admin Panel Home{% endblock %}
{% block hero_title %}Support Chats{% endblock %}
{% block hero_actions %}{% endblock %}
{% block hero_meta %}
  <span class="text-mute">Manage all active conversations with users.</span>
{% endblock %}

{% block page_content %}
  {% if chats and chats|length > 0 %}
    <ul class="split-list" aria-label="Chat conversations">
      {% for entry in chats %}
        <li class="{% if entry.unread %}unread-chat{% endif %}">
          <span class="emoji" aria-hidden="true">ðŸ’¬</span>

          <span class="text">
            <strong>{{ entry.chat.user.email }}</strong><br>

            {% if entry.last_message %}
              {{ entry.last_message.message[:80] }}{% if entry.last_message.message|length > 80 %}â€¦{% endif %}<br>
              <small>{{ entry.last_message.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</small>
            {% else %}
              <em>No messages yet</em>
            {% endif %}

            {% if entry.unread %}
              <span class="badge" aria-label="Unread">Unread</span>
            {% endif %}
          </span>

          <a href="{{ url_for('chat_blueprint.admin_view_chat', chat_id=entry.chat.id) }}"
             class="button small"
             aria-label="Open chat with {{ entry.chat.user.email }}">Open</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="empty-state" role="status" aria-live="polite">
      <div class="emoji" aria-hidden="true">ðŸ“­</div>
      <p class="empty-text">No conversations to show.</p>
      <div class="empty-actions">
        <button type="button" class="empty-btn" id="refresh-inbox">Refresh inbox</button>
        <a class="empty-btn ghost" href="{{ url_for('admin_blueprint.dashboard') }}">Go to Dashboard</a>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat/admin_chat_inbox.css') }}?v=2">
{% endblock %}

{% block extra_js %}{{ super() }}
<script src="{{ url_for('static', filename='js/chat/admin_refresh_inbox.js') }}?v=2" defer></script>
{% endblock %}
