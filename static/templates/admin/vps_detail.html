{% extends "layouts/admin_dashboard_content_base.html" %}

{% block page_title %}VPS #{{ vps.id }}{% endblock %}

{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/user_detail.css') }}">
{% endblock %}

{% block hero_back_href %}{{ url_for('admin_blueprint.dashboard') }}{% endblock %}
{% block hero_back_label %}&larr; Back to Admin Dashboard{% endblock %}
{% block hero_title %}VPS #{{ vps.id }} ‚Äî {{ vps.hostname or 'Unnamed' }}{% endblock %}
{% block hero_meta %}
  <span class="ud-meta-item"><strong>User:</strong> {{ vps.user.email if vps.user else '‚Äî' }}</span>
  <span class="ud-meta-sep">¬∑</span>
  <span class="ud-meta-item"><strong>Status:</strong> {{ vps.status|capitalize }} ({{ vps.provisioning_status }})</span>
  <span class="ud-meta-sep">¬∑</span>
  <span class="ud-meta-item"><strong>Ready:</strong> {{ 'Yes' if vps.is_ready else 'No' }}</span>
{% endblock %}

{% block page_content %}
<div class="ud-grid ud-grid--two">
  <section class="ud-card">
    <header class="ud-card-head">
      <h2 class="ud-card-title">Snapshot</h2>
    </header>
    <div class="ud-card-body">
      <dl class="ud-kv">
        <div class="ud-kv-row"><dt>ID</dt><dd>{{ vps.id }}</dd></div>
        <div class="ud-kv-row"><dt>Hostname</dt><dd>{{ vps.hostname or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>IP Address</dt><dd>{{ vps.ip_address or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>Location</dt><dd>{{ vps.location or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>Region</dt><dd>{{ vps.region or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>OS</dt><dd>{{ vps.os or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>CPU</dt><dd>{{ vps.cpu_cores or '‚Äî' }} cores</dd></div>
        <div class="ud-kv-row"><dt>RAM</dt><dd>{{ vps.ram_mb or '‚Äî' }} MB</dd></div>
        <div class="ud-kv-row"><dt>Disk</dt><dd>{{ vps.disk_gb or '‚Äî' }} GB</dd></div>

        <div class="ud-kv-row"><dt>Provider</dt><dd>{{ vps.provider or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>Provider VM ID</dt><dd>{{ vps.provider_vm_id or '‚Äî' }}</dd></div>

        <div class="ud-kv-row"><dt>Default User</dt><dd>{{ vps.default_username or '‚Äî' }}</dd></div>
        <div class="ud-kv-row"><dt>Default Password</dt><dd>{{ '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' if vps.default_password else '‚Äî' }}</dd></div>

        <div class="ud-kv-row"><dt>Provisioning</dt><dd>{{ vps.provisioning_status }}</dd></div>
        <div class="ud-kv-row"><dt>Status</dt><dd>{{ vps.status }}</dd></div>
        <div class="ud-kv-row"><dt>Ready</dt><dd>{{ 'Yes' if vps.is_ready else 'No' }}</dd></div>
        <div class="ud-kv-row"><dt>Updated</dt><dd>{{ vps.updated_at or '‚Äî' }}</dd></div>
      </dl>
    </div>
  </section>

  <section class="ud-card">
    <header class="ud-card-head">
      <h2 class="ud-card-title">Edit & Provision</h2>
    </header>
    <div class="ud-card-body">
      <form class="ud-form" method="post" action="{{ url_for('admin_blueprint.admin_vps_save', vps_id=vps.id) }}">
        <fieldset class="ud-fieldset">
          <legend class="ud-legend">Identity</legend>

          <div class="ud-field-row">
            <label class="ud-label" for="hostname">Hostname <span class="req">*</span></label>
            <div class="ud-input">
              <input type="text" id="hostname" name="hostname" value="{{ vps.hostname or '' }}" required>
            </div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="ip_address">IP Address <span class="req">*</span></label>
            <div class="ud-input">
              <input type="text" id="ip_address" name="ip_address" value="{{ vps.ip_address or '' }}" required>
            </div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="location">Location</label>
            <div class="ud-input"><input type="text" id="location" name="location" value="{{ vps.location or '' }}"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="region">Region</label>
            <div class="ud-input"><input type="text" id="region" name="region" value="{{ vps.region or '' }}"></div>
          </div>
        </fieldset>

        <hr class="ud-divider">

        <fieldset class="ud-fieldset">
          <legend class="ud-legend">Access (required)</legend>

          <div class="ud-field-row">
            <label class="ud-label" for="default_username">Default Username <span class="req">*</span></label>
            <div class="ud-input">
              <input type="text" id="default_username" name="default_username" value="{{ vps.default_username or '' }}" required>
            </div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="default_password">Default Password <span class="req">*</span></label>
            <div class="ud-input">
              <input type="password" id="default_password" name="default_password" value="{{ vps.default_password or '' }}" required>
            </div>
          </div>
        </fieldset>

        <hr class="ud-divider">

        <fieldset class="ud-fieldset">
          <legend class="ud-legend">Specs</legend>

          <div class="ud-field-row">
            <label class="ud-label" for="os">OS</label>
            <div class="ud-input"><input type="text" id="os" name="os" value="{{ vps.os or '' }}" placeholder="Ubuntu 24.04"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="cpu_cores">CPU Cores</label>
            <div class="ud-input"><input type="text" id="cpu_cores" name="cpu_cores" value="{{ vps.cpu_cores or '' }}"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="ram_mb">RAM (MB)</label>
            <div class="ud-input"><input type="text" id="ram_mb" name="ram_mb" value="{{ vps.ram_mb or '' }}"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="disk_gb">Disk (GB)</label>
            <div class="ud-input"><input type="text" id="disk_gb" name="disk_gb" value="{{ vps.disk_gb or '' }}"></div>
          </div>
        </fieldset>

        <hr class="ud-divider">

        <fieldset class="ud-fieldset">
          <legend class="ud-legend">Provider</legend>

          <div class="ud-field-row">
            <label class="ud-label" for="provider">Provider</label>
            <div class="ud-input">
              <input type="text" id="provider" name="provider" value="{{ vps.provider or '' }}" placeholder="hostup">
            </div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="provider_vm_id">Provider VM ID</label>
            <div class="ud-input"><input type="text" id="provider_vm_id" name="provider_vm_id" value="{{ vps.provider_vm_id or '' }}"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="provider_order_id">Provider Order ID</label>
            <div class="ud-input"><input type="text" id="provider_order_id" name="provider_order_id" value="{{ vps.provider_order_id or '' }}"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="image">Image</label>
            <div class="ud-input"><input type="text" id="image" name="image" value="{{ vps.image or '' }}" placeholder="ubuntu-24-04"></div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="ssh_key_id">SSH Key ID</label>
            <div class="ud-input"><input type="text" id="ssh_key_id" name="ssh_key_id" value="{{ vps.ssh_key_id or '' }}"></div>
          </div>
        </fieldset>

        <hr class="ud-divider">

        <fieldset class="ud-fieldset">
          <legend class="ud-legend">State</legend>

          <div class="ud-field-row">
            <label class="ud-label" for="status">Status</label>
            <div class="ud-input">
              <select name="status" id="status">
                {% for opt in ['pending','provisioning','active','suspended','terminated','canceled','ended'] %}
                  <option value="{{ opt }}" {{ 'selected' if vps.status == opt else '' }}>{{ opt }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="provisioning_status">Provisioning</label>
            <div class="ud-input">
              <select name="provisioning_status" id="provisioning_status">
                {% for opt in ['pending','provisioning','ready'] %}
                  <option value="{{ opt }}" {{ 'selected' if vps.provisioning_status == opt else '' }}>{{ opt }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="ud-field-row">
            <label class="ud-label" for="is_ready">Ready</label>
            <div class="ud-input">
              <label class="ud-check">
                <input type="checkbox" id="is_ready" name="is_ready" {% if vps.is_ready %}checked{% endif %}>
                Mark as ready
              </label>
            </div>
          </div>

          <div class="ud-field-row ud-field-row--notes">
            <label class="ud-label" for="notes">Notes</label>
            <div class="ud-input"><textarea id="notes" name="notes" placeholder="Internal notes for this VPS">{{ vps.notes or '' }}</textarea></div>
          </div>
        </fieldset>

        <div class="ud-actions">
          <button class="ud-btn ud-btn--primary" type="submit">üíæ Save changes</button>
          <button class="ud-btn" formaction="{{ url_for('admin_vps_provision', vps_id=vps.id) }}" formmethod="post">
            ‚öôÔ∏è Save & Provision
          </button>
          <a class="ud-btn ud-btn--ghost" href="{{ url_for('admin_vps_detail', vps_id=vps.id) }}">Cancel</a>
        </div>
      </form>
    </div>
  </section>
</div>
{% endblock %}
