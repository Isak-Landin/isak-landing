{% extends "layouts/admin_dashboard_base.html" %}
{% block title %}Admin · User #{{ user.id }}{% endblock %}

{% block extra_css %}{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/user_detail.css') }}">
{% endblock %}

{% block admin_dashboard_content %}
<a href="/admin/dashboard" class="ud-back">&larr; Back to Admin Dashboard</a>

<header class="ud-header">
  <h1>User #{{ user.id }}</h1>
  <p class="ud-meta">
    Created: {{ user.created_at or "—" }} · Updated: {{ user.updated_at or "—" }} · Last login: {{ user.last_login_at or "—" }}
  </p>
</header>

<div id="flash" class="flash" aria-live="polite"></div>

<div class="ud-grid">
  <!-- LEFT: Editable profile -->
  <section class="card ud-card">
    <h2 class="ud-card-title">Profile</h2>

    <form id="user-form" data-user-id="{{ user.id }}" class="ud-form">
      <div class="ud-two">
        <div class="ud-row">
          <label for="first_name">First name</label>
          <input id="first_name" name="first_name" type="text" value="{{ user.first_name or '' }}">
        </div>
        <div class="ud-row">
          <label for="last_name">Last name</label>
          <input id="last_name" name="last_name" type="text" value="{{ user.last_name or '' }}">
        </div>
      </div>

      <div class="ud-row">
        <label for="phone">Phone</label>
        <input id="phone" name="phone" type="text" value="{{ user.phone or '' }}">
      </div>

      <div class="ud-row">
        <label for="notes">Notes (admin only)</label>
        <textarea id="notes" name="notes" rows="4" placeholder="Internal notes…">{{ user.notes or '' }}</textarea>
      </div>

      <div class="ud-row ud-check">
        <label class="checkbox">
          <input id="is_active" name="is_active" type="checkbox" {% if user.is_active %}checked{% endif %}>
          <span>Active account</span>
        </label>
      </div>

      <div class="ud-divider"></div>

      <!-- Email (dangerous) -->
      <div class="ud-row">
        <div class="ud-row-split">
          <label for="email">Email (dangerous)</label>
          <label class="checkbox" title="Enable to edit email (dangerous)">
            <input id="toggle-email-edit" type="checkbox">
            <span>Enable edit</span>
          </label>
        </div>
        <input id="email" name="email" type="email"
               value="{{ user.email }}"
               data-original-email="{{ user.email }}"
               disabled>
        <div id="email-warning" class="ud-warn">
          <strong>Heads up:</strong> Changing the email affects login and billing.
          <label class="checkbox ud-warn-check">
            <input id="confirm-email-change" type="checkbox">
            <span>I understand the risk and want to proceed.</span>
          </label>
        </div>
      </div>

      <div class="ud-actions">
        <button id="save-btn" type="button" class="btn primary">Save changes</button>
        <button id="start-chat-btn" type="button" class="btn" disabled title="Coming soon">Start chat</button>
        <a href="/admin/dashboard" class="btn ghost">Cancel</a>
      </div>
    </form>
  </section>

  <!-- RIGHT: Summary + related -->
  <aside class="card ud-card ud-aside">
    <h2 class="ud-card-title">Customer</h2>

    <dl class="ud-kv">
      <dt>ID</dt><dd>{{ user.id }}</dd>
      <dt>Stripe Customer</dt><dd>{{ user.stripe_customer_id or "—" }}</dd>
      <dt>Full name</dt><dd>{{ user.full_name }}</dd>
      <dt>Email</dt><dd>{{ user.email }}</dd>
      <dt>Active</dt><dd>{{ "Yes" if user.is_active else "No" }}</dd>
    </dl>

    <h3 class="ud-subtitle">Subscriptions</h3>
    {% if subs and subs|length %}
      <ul class="ud-list">
        {% for s in subs %}
          <li><a href="/admin/subscriptions/{{ s.id }}">Subscription #{{ s.id }}</a></li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No subscriptions.</p>
    {% endif %}

    <h3 class="ud-subtitle">VPS Instances</h3>
    {% if vps_list and vps_list|length %}
      <ul class="ud-list">
        {% for v in vps_list %}
          <li><a href="/admin/vps/{{ v.id }}">VPS #{{ v.id }}</a></li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No VPS instances.</p>
    {% endif %}
  </aside>
</div>
{% endblock %}

{% block extra_js %}{{ super() }}
<script src="{{ url_for('static', filename='js/admin/users_detail.js') }}"></script>
{% endblock %}
