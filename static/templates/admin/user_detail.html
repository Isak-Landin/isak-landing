{# templates/admin/users_detail.html #}
{% extends "layouts/admin_dashboard_base.html" %}
{% block title %}Admin · User #{{ user.id }}{% endblock %}

{% block extra_css %}{{ super() }}{% endblock %}

{% block admin_dashboard_content %}

  <!-- HERO (matches dashboard look) -->
  <section class="radial-dark-section hero-condensed">
    <div class="container">
      <a href="/admin/dashboard" class="back-link">&larr; Back to Admin Dashboard</a>
      <h1>User #{{ user.id }}</h1>
      <div class="hero-marker"></div>
      <p class="intro-lead">
        Created: {{ user.created_at or "—" }} · Updated: {{ user.updated_at or "—" }} · Last login: {{ user.last_login_at or "—" }}
      </p>
    </div>
  </section>

  <!-- MAIN (uses the same split-section/container rhythm) -->
  <section class="split-section">
    <div class="container">

      <div id="flash" class="flash" aria-live="polite"></div>

      <!-- Row 1: Customer snapshot + Profile editor -->
      <div class="cards-row">
        <!-- Customer snapshot -->
        <div class="card">
          <h2>Customer</h2>
          <dl class="kv">
            <dt>ID</dt><dd>{{ user.id }}</dd>
            <dt>Stripe Customer</dt><dd>{{ user.stripe_customer_id or "—" }}</dd>
            <dt>Full name</dt><dd>{{ user.full_name }}</dd>
            <dt>Email</dt><dd>{{ user.email }}</dd>
            <dt>Status</dt><dd>{{ "Active" if user.is_active else "Inactive" }}</dd>
          </dl>
        </div>

        <!-- Profile editor (Label | Current | Edit) -->
        <div class="card">
          <h2>Profile</h2>

          <form id="user-form" data-user-id="{{ user.id }}" class="ud-formgrid">
            <!-- First name -->
            <div class="ud-row3">
              <label for="first_name">First name</label>
              <div class="ud-current">{{ user.first_name or "—" }}</div>
              <div class="ud-edit">
                <input id="first_name" name="first_name" type="text" value="{{ user.first_name or '' }}">
              </div>
            </div>

            <!-- Last name -->
            <div class="ud-row3">
              <label for="last_name">Last name</label>
              <div class="ud-current">{{ user.last_name or "—" }}</div>
              <div class="ud-edit">
                <input id="last_name" name="last_name" type="text" value="{{ user.last_name or '' }}">
              </div>
            </div>

            <!-- Phone -->
            <div class="ud-row3">
              <label for="phone">Phone</label>
              <div class="ud-current">{{ user.phone or "—" }}</div>
              <div class="ud-edit">
                <input id="phone" name="phone" type="text" value="{{ user.phone or '' }}">
              </div>
            </div>

            <!-- Notes -->
            <div class="ud-row3">
              <label for="notes">Notes (admin only)</label>
              <div class="ud-current">{{ user.notes or "—" }}</div>
              <div class="ud-edit">
                <textarea id="notes" name="notes" rows="4" placeholder="Internal notes…">{{ user.notes or '' }}</textarea>
              </div>
            </div>

            <!-- Status -->
            <div class="ud-row3">
              <label>Status</label>
              <div class="ud-current">{{ "Active" if user.is_active else "Inactive" }}</div>
              <div class="ud-edit">
                <label class="checkbox">
                  <input id="is_active" name="is_active" type="checkbox" {% if user.is_active %}checked{% endif %}>
                  <span>Active account</span>
                </label>
              </div>
            </div>

            <hr>

            <!-- Email (dangerous) -->
            <div class="ud-row3">
              <label for="email">Email (dangerous)</label>
              <div class="ud-current">{{ user.email }}</div>
              <div class="ud-edit">
                <label class="checkbox" title="Enable to edit email (dangerous)">
                  <input id="toggle-email-edit" type="checkbox">
                  <span>Enable edit</span>
                </label>

                <input id="email" name="email" type="email"
                       value="{{ user.email }}"
                       data-original-email="{{ user.email }}"
                       disabled>

                <div id="email-warning" class="ud-warn">
                  <strong>Heads up:</strong> Changing the email affects login and billing.
                  <label class="checkbox ud-warn-check">
                    <input id="confirm-email-change" type="checkbox">
                    <span>I understand the risk and want to proceed.</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="ud-actions">
              <button id="save-btn" type="button" class="btn primary">Save changes</button>
              <button id="start-chat-btn" type="button" class="btn" disabled title="Coming soon">Start chat</button>
              <a href="/admin/dashboard" class="btn ghost">Cancel</a>
            </div>
          </form>
        </div>
      </div>

      <!-- Row 2: Related entities below -->
      <div class="cards-row">
        <div class="card">
          <h3>Subscriptions</h3>
          {% if subs and subs|length %}
            <ul class="list">
              {% for s in subs %}
                <li><a href="/admin/subscriptions/{{ s.id }}">Subscription #{{ s.id }}</a></li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="muted">No subscriptions.</p>
          {% endif %}
        </div>

        <div class="card">
          <h3>VPS Instances</h3>
          {% if vps_list and vps_list|length %}
            <ul class="list">
              {% for v in vps_list %}
                <li><a href="/admin/vps/{{ v.id }}">VPS #{{ v.id }}</a></li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="muted">No VPS instances.</p>
          {% endif %}
        </div>
      </div>

    </div>
  </section>

{% endblock %}

{% block extra_js %}{{ super() }}
<script src="{{ url_for('static', filename='js/admin/users_detail.js') }}"></script>
{% endblock %}
